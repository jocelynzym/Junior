# 编程文档

[TOC]

## 1 环境搭建

- **系统**：win10环境

- **前端**：PyQt5

  cmd输入如下命令安装

  ```bash
  pip install PyQtChart --user
  ```

- **后端**：MySQL

- **编程语言**

  - 前端: python
  - 后端: SQL



## 2 文件说明

### 2.1 综述

- 后端：使用sqlite创建数据库，建表，插入数据，保存为数据库文件test.db, 供前端调用
- 前端：使用PyQt5编写图形界面。同时PyQt5通过一个类`QSqlDatabase`来连接数据库文件 test.db 作为接口。我们调用该类的方法即可对数据库进行操作

### 2.2 文件说明







## 3 PyQt5介绍

### 3.1 参考资料

- [简书：PyQt5数据库编程](https://www.jianshu.com/nb/14146618)
- [译制文档：PyQt5中文教程](http://code.py40.com/pyqt5/14.html)
- [CSDN：PyQt5之SQLite数据库操作](https://blog.csdn.net/weixin_42686768/article/details/87992476#1_3)

### 3.2 PyQt5怎样使用数据库

PyQt5包括不需要安装任何额外Python库，就可用于操作SQLite，MySQL，Oracle，PostgreSQL和其他的数据库的工具。

#### 3.2.1 连接数据库

- **导入库文件**

  ```python
  from PyQt5 import QtSql
  from PyQt5.QtSql import QSqlQuery
  ```

  `QtSql`类即Qt中的`QSqlDatabase`类，用于处理与数据库的连接

  `QSqlQuery`类提供了执行和操作SQL语句的方法

- **连接到sqlite数据库**

  `QSqlDatabase`类负责连接数据库和处理事务。 要建立与数据库的连接，必须调用此类的静态`addDatabase()`方法。

  ```python
  #打开SQLite数据库
  database = QtSql.QSqlDatabase.addDatabase('QSQLITE')
  #数据库文件路径及名字
  database.setDatabaseName("../2_sqlite3/data/test.db")
  #打开数据库,打开成功返回True
  database.open()
  ```

  没有test.db这个文件的时候则会在当前目录新建一个test.db文件

- **怎样使用数据库**

  `addDatabase()`方法返回一个`QSqlDatabase`类的实例，它表示建立连接的数据库

  `QSqlDatabase`类的方法详见[传送门](http://doc.qt.io/qt-5/qsqldatabase.html) ,

- **注意: 先创建应用程序对象**

  在创建到数据库的连接之前，应该创建一个应用程序对象 (QApplication对象的一个实例)。 如果没有这样做，PyQt将无法下载指定数据库格式的驱动程序，也不会创建连接。 要打开的数据库必须已经存在于磁盘或服务器上。 唯一的例外是SQLite数据库，如果打开时不存在，将动自动创建。 

- **例子: 连接数据库并打开**

  ```python
  #导入库文件
  from PyQt5 import QtWidgets, QtSql
  import sys
  #创建一个应用程序对象，否则数据库支持将不起作用
  app = QtWidgets.QApplication（sys.argv）
  
  #打开SQLite数据库
  con1 = QtSql.QSqlDatabase.addDatabase（'QSQLITE'）
  con1.setDatabaseName（"c://work//data.sqlite"）
  con1.open（）
  con1.close（）
  
  #打开MySQL数据库
  con2 = QtSql.QSqlDatabase.addDatabase（'QMYSQL'）
  con2.setHostName（“somehost”）
  con2.setDatabaseName（“somedb”）
  con2.setUserName（“someuser”）
  con2.setPassword（“password”）
  con2.open（）
  con2.close（）
  ```

#### 3.2.2 新建表

- 建立一个名为student的表，包含id,name,age三个属性，其中ID为主键

  ```python
  query = QSqlQuery()
  query.prepare('create table student (id int primary key, name varchar(30),age int)')
  if not query.exec_():
      query.lastError()
  else:
      print('create a table')
  ```

#### 3.2.3 插入数据

- `addBindValue()`将值添加到student表中，调用顺序决定添加的顺序

  ```python
  insert_sql = 'insert into student values (?,?,?)'
  query.prepare(insert_sql)
  query.addBindValue(4)
  query.addBindValue('Tom')
  query.addBindValue(18)
  if not query.exec_():
      print(query.lastError())
  else:
  	print('inserted')
  ```

#### 3.2.4 查询

- 查询返回数据使用`value(int)`函数，例如对于查询语句select id,name,age from student 来说，value(0)等于返回id属性的值，value(2)等于age属性
  `exec_()`查询成功返回true查询 否则返回false

  ```python
  query_sql = 'select id,name,age from student'
  query.prepare(query_sql)
  if not query.exec_():
      query.lastError()
  else:
      while query.next():
          id = query.value(0)
          name = query.value(1)
          age =query.value(2)
          print(id,name,age)    
  ```

- 可以通过`record.indexOf(str)`来获取索引值

  ```python
  if query.exec('select id ,name,age from student'):
      id_index = query.record().indexOf('id')
      name_index = query.record().indexOf('name')
      age_index = query.record().indexOf('age')
      while query.next():
          id = query.value(id_index)
          name = query.value(name_index)
          age = query.value(age_index)
          print(id, name, age)
  ```

#### 3.2.5 获取SQLite数据库中的表信息

- **查询所有表名信息**

  SQLite数据库中的信息存在于一个内置表sqlite_master中，在查询器中可以用:select * from sqlite_master来查看。如果只要列出所有表名的话，则只要一个语句:SELECT name FROM sqlite_master WHERE type=‘table’ order by name，因为表的列type固定为table

  ```python
  select * from sqlite_master;
  select * from sqlite_sequence;
  ```

- **查询所有表名并排序**

  ORDER BY 语句用于根据指定的列对结果集进行排序

  ```python
  select name from sqlite_master where type='table' order by name
  select name from sqlite_sequence order by name
  ```

- **返回tables数据表的数量**

  ```python
  select ount(*) from sqlite_sequence
  select count(*) from sqlite_master;
  ```

- **返回指定表的字段信息**

  ```python
  pragma table_info(table_name)
  ```

### 3.3 PyQt5编写图形界面













